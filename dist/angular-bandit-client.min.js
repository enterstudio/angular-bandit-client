"use strict";!function(e){function n(e,n,t){return!!e&&n.indexOf(e.arm)>-1&&e.ts>(new Date).getTime()-t.ttl}function t(n,t){e.forEach(n,function(e,n){t.setItem("$bandit:"+n,{arm:e,ts:(new Date).getTime()})})}function r(n){var t=[];return e.forEach(n,function(e,n){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}),t.join("&")}e.module("bandit",["LocalForageModule"]).provider("$bandit",function(){var o={experiments:{},uri:{},tts:6048e5};return{add:function(e,n){return o.experiments[e]=n,this},uri:function(e){return o.uri=e,this},ttlInSeconds:function(e){return o.ttl=1e3*e,this},$get:["$q","$http","$localForage",function(i,u,c){var a=i.defer(),s={$resolved:!1,$promise:a.promise,$reward:function(){var n={};return e.forEach(arguments,function(e){n[e]=s[e]}),0!=Object.keys(n)?u.put(o.uri,n,{transformRequest:r,headers:{"Content-Type":"application/x-www-form-urlencoded"}}):void 0}},f={},d=[];return e.forEach(o.experiments,function(e,t){var r=c.getItem("$bandit:"+t).then(function(r){n(r,e,o)?s[t]=r.arm:f[t]=e.join(",")}).catch(function(){f[t]=e.join(",")});d.push(r)}),i.all(d).finally(function(){return 0==Object.keys(f).length?(s.$resolved=!0,a.resolve(s),void t(s,c)):void u.get(o.uri,{params:f}).success(function(n){e.extend(s,n)}).error(function(){e.forEach(o.experiments,function(e,n){s[n]=e[0]})}).finally(function(){s.$resolved=!0,a.resolve(s),t(s,c)})}),s}]}})}(angular);