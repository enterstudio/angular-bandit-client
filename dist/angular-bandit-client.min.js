"use strict";!function(n){function e(n,e,t){return!!n&&e.indexOf(n.arm)>-1&&n.ts>(new Date).getTime()-t.ttl}function t(e,t){n.forEach(e,function(n,e){t.setItem("$bandit:"+e,{arm:n,ts:(new Date).getTime()})})}function r(e){var t=[];return n.forEach(e,function(n,e){t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))}),t.join("&")}n.module("bandit",["LocalForageModule"]).directive("banditReward",function(n){return{restrict:"A",link:function(e,t,r){t.on("click",function(){n.$reward.apply(n,r.banditReward.split(","))})}}}).provider("$bandit",function(){var i={experiments:{},uri:{},ttl:6048e5};return{add:function(n,e){return i.experiments[n]=e,this},uri:function(n){return i.uri=n,this},ttlInSeconds:function(n){return i.ttl=1e3*n,this},$get:["$q","$http","$localForage",function(o,u,c){var a=o.defer(),f={$resolved:!1,$promise:a.promise,$reward:function(){var e={};return n.forEach(arguments,function(n){e[n]=f[n]}),0!=Object.keys(e)?u.put(i.uri,e,{transformRequest:r,headers:{"Content-Type":"application/x-www-form-urlencoded"}}):void 0}},s={},d=[];return n.forEach(i.experiments,function(n,t){var r=c.getItem("$bandit:"+t).then(function(r){e(r,n,i)?f[t]=r.arm:s[t]=n.join(",")}).catch(function(){s[t]=n.join(",")});d.push(r)}),o.all(d).finally(function(){return 0==Object.keys(s).length?(f.$resolved=!0,a.resolve(f),void t(f,c)):void u.get(i.uri,{params:s}).success(function(e){n.extend(f,e)}).error(function(){n.forEach(i.experiments,function(n,e){f[e]=n[0]})}).finally(function(){f.$resolved=!0,a.resolve(f),t(f,c)})}),f}]}})}(angular);